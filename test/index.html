<!DOCTYPE html>
<html>
	<head>
		<title>PolyClay models test</title>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<script src="ender.min.js" type="text/javascript"></script>
		<script src="mote.js" type="text/javascript"></script>
		<script src="../beam.js" type="text/javascript"></script>
		<script src="../polyclay.js" type="text/javascript"></script>
	</head>
	<body>
<p>Really horribly inadequate testing, I know. That's why this isn't released.</p>

<div>
	<button id="bleat">Bleat</button>
</div>

<p><img id="octocat" src="" alt="image src setting test" height="200" /></p>

<h3>Beam-specific tests</h3>

<script type="text/html" id="test1">
<div><i>Hello,</i> {{last}} {{first}} {{last}}.</div>
</script>
<script type="text/html" id="test2">
<div>{{#potatoes}}{{.}} potato, {{/potatoes}}4.</div>
</script>

<script type="text/html" id="templates">
<p>This template has an illegal name!</p>
</script>

<div id="inserthere">
</div>

<h3>Single item!</h3>
<div id="putfoohere"></div>

<h3>Collection!</h3>
<div id="collectionhere"></div>
	
<script id="foobox" type="text/html">
<p>
<b>Name:</b> {{name}}<br />
<b>Swizzling:</b> {{swizzle}}<br />
<b>Count:</b> {{count}}<br />
<b>Report:</b> {{report}}
</p>
</script>

<script type="text/javascript">
var bean = require('bean');
var qwery = require('qwery');

var greet = mote.compile('Greetings, {{name}}.');
var test = greet({name: 'Arthur Dent'}); //=> 'Greetings, Arthur Dent.'
console.log(test);

var catsrc = "http://octodex.github.com/images/orderedlistocat.jpg";

var Foo = PolyClay.Model.extend({
	properties: {
		name: 'string',
		swizzle: 'string',
		count: 'number',
		isCool: 'boolean',
	},
	calculated: ['report', ],
	template: 'foobox',
},
{
	initialize: function(shoutit)
	{
		console.log(shoutit);
		this.watch('change:name', this.updateCalculated);
		this.watch('change:count', this.updateCalculated);
		this.watch('change:isCool', this.updateCalculated);
	},
	updateCalculated: function()
	{
		this.report(this.name() + ' has '+this.count() + ' ' + this.swizzle() + ' and is ' + (this.isCool() ? '' : 'not ') +'cool.');
		console.log(this.report());
	},
});

var bleat = new Foo('yippee!');
console.log(bleat);

bleat.name('can haz name');
console.log(bleat.name());
console.log(bleat.report());
console.log(bleat.swizzle());
bleat.swizzle('sparkle');
console.log(bleat.swizzle());
console.log(bleat.report());
bleat.count(bleat.count() + 2);

bleat.update({name: 'my new name', swizzle: 'sparklestick'}, false);
console.log("should see type error next");
bleat.isCool(4);
bleat.isCool(true);

var FooCollection = PolyClay.Collection.extend({
	model: Foo,
	urlroot: '/foos',
},
{
	initialize: function(element)
	{
		this.element(element);
		this.watch('reset', this.render);
		this.watch('add', this.render);
	},
});

$(document).ready(function()
{
	console.log("We expect an error in the console about an illegal template name.");
	$('#octocat').attr('src', catsrc);

	var rendered = beam.test1({ first: 'Arthur', last: 'Dent' });
	$('#inserthere').append(rendered);

	var data = {potatoes: [1, 2, 3]};
	var potatoes = beam.test2({potatoes: [1, 2, 3]});
	console.log(potatoes);
	$('#inserthere').append(potatoes);

	$('#putfoohere').append(bleat.renderToString());
	
	var listthing = new FooCollection('#collectionhere');
	listthing.push(bleat);

	listthing.reset([
		{name: 'reset1', swizzle: 'spider', count: 3},
		{name: 'reset2', swizzle: 'spider', count: 4}
	]);
	
	var another = new Foo();
	another.name('Another One');
	another.swizzle('swizzlesticks galore');
	another.count(7);
	listthing.push(another);

	var another = new Foo();
	another.name('Three times is the charm');
	another.swizzle('drumsticks');
	another.count(100);	
	listthing.insert(another, 1);

	bean.add(qwery('#bleat'), 'click', function(e)
	{
		alert("bleat!");
	});
	
	$('#bleat').click(function(e)
	{
		alert("bleat!");
	});

	bean.fire(qwery('#bleat'), 'click');
});

</script>
	
	</body>
</html>